{% extends "admin/base_site.html" %}
{% load i18n iadmin %}
{% block extrahead %}{{ block.super }}
    <script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}iadmin/js/jquery.min.js"></script>
    <script type="text/javascript">
        (function($) {
            $(document).ready(function($) {
                $('#back').click(function() { window.location.href="{{ back }}" });
                $('#reset').click(function() { window.location.href=window.location.href });
                {% if not form.errors %}
                $(".rex input, .key input").hide();
                {% endif %}
                $("#advanced").click(function(){$(".rex input, .key input").toggle();});
            });
        })(jQuery);
    </script>
<style type="text/css">
    .col, .fld{
        width: 100px;
    }
    .rex{width: 400px;
    }
</style>
{% endblock %}
{% block breadcrumbs %}
    <div class="breadcrumbs">
        <a href="{% url admin:index %}">{% trans "Home" %}</a> &rsaquo;
        {% if app_label %}
            <a href="{% url admin:index %}{{ app_label}}">{{ app_label|capfirst }}</a> &rsaquo;
            {% if model %}<a href="{% url admin:index %}{{ app_label}}/{{ model }}">{{ model|capfirst }}</a> &rsaquo;{% endif %}
        {% endif %}
        {% if page == 1 %}
            Import
        {% else %}
            <a href="../import/1">Import</a> &rsaquo; Mapping
        {% endif %}
    </div>

{% endblock %}

{% block content %}
    <form enctype="multipart/form-data" method="post" action="{{ page }}">{% csrf_token %}
    <div class="clear">
        {% if page > 1 %}<input type="button" id="back" value="{{ lbl_back }}">{% endif %}<input type="submit" value="{{ lbl_next }}">
        &nbsp;&nbsp;&nbsp;<input type="button" id="reset" value="Reset">&nbsp;&nbsp;&nbsp;</div>
        <input type="hidden" name="page" value="{{ page }}"

        {% if page == 1 %}
        <div id='form' class="left">
            <table border="0" width="600" cellpadding="0" cellspacing="0">
                {{ form }}
            </table>
        </div>
        {% endif %}

        {% if page == 2 %}
        <div id='form' class="left">
            <table border="0" width="600" cellpadding="0" cellspacing="0">
                <tr><td>Advanced Options</td><td colspan="2"></td><td><input type="checkbox" {% if form.errors %}checked="checked"{% endif %} id="advanced" name="advanced"></td></tr>
                {{ form }}
            </table>
        </div>
        {% endif %}
        {% if page == 2 %}
            <div id='sample' class="right">
                <table>
                    <tr>{% for i in form.columns_count|range %}
                        <th>Column #{{ i }}</th>{% endfor %}
                    <tr/>
                    {% for row in form.sample %}
                        <tr>
                            {% for cell in row %}
                                <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        {% endif %}
        <div id="records">
            {% if page == 3 %}
                <input type="text" name="apply" value="apply">
                <input type="text" name="mapping" value="{{ mapping }}">
                <table>
                    <tr>{% for f in fields %}
                        <th>{{ f.name }}</th>{% endfor %}</tr>
                    {% for row, exists in records %}
                        <tr>
                            {% for f in fields %}
                                <td>{{ row|getattr:f.name }}</td>
                            {% endfor %}
                                <td>{{ exists }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
    </form>

{% endblock %}